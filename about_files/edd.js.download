class EstimateDelivery extends HTMLElement{constructor(){super(),document?.getElementById("pincode-input")?.addEventListener("focusout",()=>{this.focusOutInput()}),document?.getElementsByClassName("locate-pincode-wrapper")[0]?.addEventListener("click",()=>{this.getLocationPincode()}),this.handlePincodeInput=this.handlePincodeInput.bind(this),this.pageType=this.dataset.pageType,this.apiUsername="vaaree",this.apiKey="666df8a8-f2e9-4fdf-a9cf-30350459b629",this.vendorPincodeStr=JSON.stringify(this.dataset.vendorPincodeStr),this.vendorPincode=JSON.parse(this.dataset.vendorPincodeStr),this.vendorName=this?.dataset?.productVendor||"",this.productTags=this?.dataset?.productTags?JSON.parse(this?.dataset?.productTags):[],this.fbvFilterTagName=this.dataset.fbvFilterTag||"fbv",this.defaultNumberOfDays=4,this.defaultNumberOfDaysFBV=3,this.productId=this.dataset.productId,this.errorMessages={invalidPincode:"Delivery not available on pincode",emptyPincode:"Please enter PIN code to check delivery time",vendorNotFound:"Vendor Not Found"},this.localStorageKeys={deliveryPincode:"delivery-pincode",estimateDeliveryDays:"estimate-delivery-days"},this.type={inbound:"INBOUND",outbound:"OUTBOUND",metrocity:"METROCITY",priority_state:"PRIORITYSTATE",default:"DEFAULT"},this.estimateDeliveryMapping={INBOUND:["bengaluru"],OUTBOUND:["karnataka"],METROCITY:["mumbai","pune","delhi","kolkata","chennai","hyderabad","ahmedabad","surat","jaipur","lucknow","kanpur"],PRIORITYSTATE:["andhra pradesh","tamil nadu","kerala","telangana","maharashtra"]},this.init()}init(){if(this.pageType==="product"){var pincodeInputContainer=document.getElementById("input-container"),defaultEstimateDeliveryInfo=document.getElementsByClassName("default-estimate-delivery-info")[0],deliveryTextElement=document.getElementsByClassName("default-end_delivery")[0],deliveryInfoFbv=document.getElementsByClassName("delivery-info-fbv")[0],estimateDeliveryDateElementFbv=document.getElementsByClassName("end_delivery-fbv")[0];this.fbvTagExist(this.productTags)?(deliveryInfoFbv.style.display="flex",defaultEstimateDeliveryInfo.style.display="none",estimateDeliveryDateElementFbv.textContent="3 Day Delivery"):deliveryTextElement&&(deliveryTextElement.textContent=`9:00PM on ${this.calculateDeliveryDate(this.defaultNumberOfDays,0)}`);var pincodeInput=document.getElementById("pincode-input");pincodeInputContainer.addEventListener("submit",this.handleCheckButton),pincodeInput.addEventListener("input",this.handlePincodeInput),pincodeInputContainer.addEventListener("click",()=>this.focusOnInput("pincode-input"));var storedPincode=this.getLocalStorageItem(this.localStorageKeys.deliveryPincode)||document.getElementById("pincode-input").value;storedPincode&&this.showEstimateDeliveryDate(storedPincode,this.productTags)}if(this.pageType==="collection"){this.setDefaultDateInCollectionPage(this.defaultNumberOfDays,this.productId,this.productTags);var doesPincodeExists=this.getLocalStorageItem("delivery-pincode");window.innerWidth<768&&document.querySelector(".sticky-filter-sort-container")&&(doesPincodeExists?document.querySelector(".sticky-filter-sort-container").style.top="85px":document.querySelector(".sticky-filter-sort-container").style.top="66px");var storedPincode=this.getLocalStorageItem(this.localStorageKeys.deliveryPincode);storedPincode&&this.showEstimateDeliveryDateonPlpPage(storedPincode,this.productId,this.productTags),window.addEventListener("popstate",function(event){event.state&&event.state.page==="{{routes.collections_url}}"&&window.location.reload()})}}getLocalStorageItem(key){return localStorage.getItem(key)}setEstimateDeliveryTextForFLV(result){const lowerCaseCity=result.city.toLowerCase(),lowerCaseState=result.state.toLowerCase();return this.estimateDeliveryMapping[this.type.inbound].includes(lowerCaseCity)?this.sameDayDelivery()?"Delivery Today":"Delivery Tomorrow":this.estimateDeliveryMapping[this.type.outbound].includes(lowerCaseState)?this.isBetween3PMAnd12PM()?"3 Day Delivery":"2 Day Delivery":this.type.default}sameDayDelivery(){var currentDate=new Date,currentHour=currentDate.getHours(),currentMinutes=currentDate.getMinutes();return currentHour<12||currentHour===12&&currentMinutes<30}isBetween3PMAnd12PM(){var currentHour=new Date().getHours();return currentHour>=15&&currentHour<=24}isValidPinCode(code){var regex=/^[1-9]{1}[0-9]{2}\s{0,1}[0-9]{3}$/;return regex.test(code)}getCityStateFromPincode=async pincode=>{try{var options={method:"GET",headers:{accept:"application/json"}},response=await fetch(`https://www.clickpost.in/api/v2/pincode_details/?pincode=${pincode}&key=${this.apiKey}`,options);if(!response.ok)throw new Error("Network response was not ok");var responseData=await response.json();if(responseData.meta.message==="Success")return responseData.result;throw new Error(responseData.Message)}catch(err){return console.log({err}),0}};isPincodeServiceable=async(pickupPincode,dropPincode)=>{try{var payload=[{pickup_pincode:pickupPincode,drop_pincode:dropPincode}],response=await fetch(`https://ds.clickpost.in/api/v2/predicted_sla_api/?username=${this.apiUsername}&key=${this.apiKey}&check_drop_pincode_validity=true`,{method:"POST",body:JSON.stringify(payload),headers:{"Content-Type":"application/json"}});if(!response.ok)throw new Error("Network response was not ok");var responseData=await response.json();if(responseData.meta.message==="SUCCESS")return responseData.result;throw new Error(responseData.Message)}catch(error){throw error}};showEstimateDeliveryDate=async(pincode,productTags=[])=>{if(pincode){document.getElementById("pincode-input").value=pincode;var deliveryInfo=document.getElementsByClassName("delivery-info")[0],deliveryInfoContainer=document.getElementsByClassName("section-delivery-return-container")[0],deliveryInfoFbv=document.getElementsByClassName("delivery-info-fbv")[0],verifiedIcon=document.getElementsByClassName("verified-icon")[0],estimateDeliveryDateElement=document.getElementsByClassName("end_delivery")[0],estimateDeliveryDateElementFbv=document.getElementsByClassName("end_delivery-fbv")[0],defaultEstimateDeliveryDateElement=document.getElementsByClassName("default-estimate-delivery-info")[0],enterInputTextElement=document.getElementsByClassName("enter-pincode-text")[0];try{var result,estimatedDeliveryText;if(this.fbvTagExist(this.productTags))result=await this.getCityStateFromPincode(pincode),result&&(deliveryInfo.style.display="none",deliveryInfoContainer.style.display="none",deliveryInfoFbv.style.display="flex",estimatedDeliveryText=this.setEstimateDeliveryTextForFLV(result),this.showEstimatedDeliveryForFBV(result,estimatedDeliveryText,deliveryInfoFbv,estimateDeliveryDateElementFbv));else{var pickupPincode=this.getVendorPinCode(this.vendorName);result=await this.isPincodeServiceable(pickupPincode,pincode);var estimatedDays=result[0].predicted_sla_min;estimatedDays&&(estimatedDeliveryText=this.calculateDeliveryDate(parseInt(estimatedDays)),deliveryInfo.style.display="flex",deliveryInfoContainer.style.display="flex",deliveryInfoFbv.style.display="none",estimateDeliveryDateElement.textContent=`9:00PM on ${estimatedDeliveryText}`)}this.hideDefaultEstimateDeliveryDate(defaultEstimateDeliveryDateElement,enterInputTextElement),this.showverifiedIcon(verifiedIcon),this.isPincodeVerifiedMarkup(!0)}catch(error){if(console.log({errMsg:error}),error&&error.message&&error.message===this.errorMessages.vendorNotFound){if(result=await this.getCityStateFromPincode(pincode),!result){this.showErrorMessage(this.errorMessages.invalidPincode);return}setLocalStorageItem(this.localStorageKeys.deliveryPincode,pincode),setLocalStorageItem(this.localStorageKeys.estimateDeliveryDays,this.defaultNumberOfDays);var estimateDeliveryDate=this.calculateDeliveryDate(parseInt(this.defaultNumberOfDays),0);estimateDeliveryDateElement!=null&&(estimateDeliveryDateElement.textContent=`9:00PM on ${estimateDeliveryDate}`,this.hideDefaultEstimateDeliveryDate(defaultEstimateDeliveryDateElement,enterInputTextElement)),deliveryInfo!=null&&(deliveryInfo.style.display="flex",deliveryInfoContainer.style.display="flex"),this.showverifiedIcon(verifiedIcon),this.isPincodeVerifiedMarkup(!0);return}this.showErrorMessage(this.errorMessages.invalidPincode)}}};isPincodeVerifiedMarkup(status){document.getElementById("pincode-input").style.border=status===!0?"1px solid #839A51":"1px solid #262727",document.getElementById("pincode-input").style.fontWeight=600,document.getElementById("check-button").textContent=status===!0?"Applied":"Apply",document.getElementById("check-button").style.opacity=status===!0?"0.25":"1",document.getElementById("pincode-input").style.color=status===!0?"#839A51":"#262727",document.getElementsByClassName("check_tick_img")[0].style.display=status===!0?"block":"none",document.querySelector(".pincode-input[type=tel]").style.paddingLeft=status===!0?"36px":"12px",document.getElementById("check-button").style.zIndex=status===!0?"0":"350"}displayWrapper(elementToShow,elementToHide){elementToShow&&elementToHide&&(elementToShow.style.display="flex",elementToHide.style.display="none")}hideDefaultEstimateDeliveryDate(defaultEstimateDeliveryDateElement,enterInputTextElement){defaultEstimateDeliveryDateElement&&(defaultEstimateDeliveryDateElement.style.display="none",enterInputTextElement.textContent=this.errorMessages.emptyPincode)}showverifiedIcon(verifiedIcon){verifiedIcon.style.display="block"}showEstimateDeliveryDateonPlpPage=async(dropPincode,product_id="",productTags)=>{var deliveryDateSectionElement=document.querySelectorAll(".delivery_date_section"),deliveryDateWrapperElement=document.getElementById(`delivery_date_wrapper_${product_id}`),deliveryDateWrapperElementFBV=document.getElementById(`delivery_date_wrapper_fbv_${product_id}`),deliveryTextElement=document.getElementById(`end_delivery_${product_id}`),deliveryTextElementFBV=document.getElementById(`end_delivery_fbv_${product_id}`);if(!(dropPincode.length===0||!product_id)&&isValidPinCode(dropPincode))try{if(this.fbvTagExist(this.productTags)){if(result=await this.getCityStateFromPincode(dropPincode),result){var deliveryText=this.setEstimateDeliveryTextForFLV(result);this.showEstimatedDeliveryForFBV(result,deliveryText,deliveryDateWrapperElementFBV,deliveryTextElementFBV),this.displayWrapper(deliveryDateWrapperElementFBV,deliveryDateWrapperElement)}}else{var pickupPincode=this.getVendorPinCode(this.vendorName),result=await this.isPincodeServiceable(pickupPincode,dropPincode),estimateDeliveryDays=result[0].predicted_sla_min;setLocalStorageItem(this.localStorageKeys.deliveryPincode,dropPincode),setLocalStorageItem(this.localStorageKeys.estimateDeliveryDays,estimateDeliveryDays),deliveryDateSectionElement.forEach(el=>el.textContent="Delivery by");var deliveryText=this.calculateDeliveryDate(estimateDeliveryDays);deliveryTextElement.textContent=deliveryText,this.displayWrapper(deliveryDateWrapperElement,deliveryDateWrapperElementFBV)}}catch(error){if(error&&error.message&&error.message===this.errorMessages.vendorNotFound){setLocalStorageItem(this.localStorageKeys.deliveryPincode,dropPincode),setLocalStorageItem(this.localStorageKeys.estimateDeliveryDays,this.defaultNumberOfDays),this.displayWrapper(deliveryDateWrapperElement,deliveryDateWrapperElementFBV);return}}};getOrdinalSuffix(day){if(day>=11&&day<=13)return"th";switch(day%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}calculateDeliveryDate(numberOfDays,buffer=1){try{var currentDate=new Date,estimatedDeliveryDate=new Date(currentDate);estimatedDeliveryDate.setDate(currentDate.getDate()+numberOfDays+buffer);var formattedDeliveryDate=estimatedDeliveryDate.toLocaleDateString("en-US",{weekday:"short",day:"numeric",month:"short",year:"numeric"}),deliveryDay=formattedDeliveryDate.split(",")[0],dateParts=formattedDeliveryDate.split(",")[1].split(" "),deliveryDate=dateParts[2],deliveryMonth=dateParts[1];return`${deliveryDay}, ${deliveryDate}${this.getOrdinalSuffix(deliveryDate)} ${deliveryMonth}`}catch(err){console.log({err})}}getVendorPinCode(vendorName){if(!this.vendorPincode[vendorName])throw new Error(this.errorMessages.vendorNotFound);return this.vendorPincode[vendorName]}showErrorMessage(text){document.getElementById("pincode-input").style.border="solid 1px #ed546f";var pincodeErrorBanner=document.getElementsByClassName("pincode-error-banner")[0],pincodeErrorMessage=document.getElementsByClassName("error-message")[0],swatchBanner=document.getElementsByClassName("swatch_banner")[0];let defaultDelivery=document.getElementsByClassName("default-estimate-delivery-info")[0];defaultDelivery&&(defaultDelivery.style.display="none"),swatchBanner&&(swatchBanner.style.display="none"),pincodeErrorBanner.style.display="flex",pincodeErrorMessage.textContent=text+` ${document.getElementById("pincode-input").value}`}focusOnInput(inputElement){var input=document.getElementById(inputElement);input.style.border="1px solid #262727",input.focus()}fbvTagExist(productTags){if(productTags&&productTags.length>0){var lowerCaseTags=productTags.map(tag=>tag.toLowerCase());if(lowerCaseTags.includes(this.fbvFilterTagName.toLowerCase()))return!0}return!1}showEstimatedDeliveryForFBV(result,deliveryText,deliveryDateWrapperElementFBV,deliveryTextElementFBV){var deliveryText=this.setEstimateDeliveryTextForFLV(result);if(deliveryText===this.type.default){var defaultDeliveryDate=this.calculateDeliveryDate(this.defaultNumberOfDaysFBV);deliveryDateWrapperElementFBV.classList.add("default-fbv-date"),deliveryTextElementFBV.innerHTML=`<span class="delivery_by">Delivery by</span> ${defaultDeliveryDate}`}else deliveryDateWrapperElementFBV.classList.remove("default-fbv-date"),deliveryTextElementFBV.textContent=deliveryText}showHideSpinner(val){document.getElementById("check-button").style.display=val===!0?"none":"block",document.getElementsByClassName("spinner-pincode")[0].style.display=val===!0?"block":"none"}handleCheckButton=async e=>{e&&e.preventDefault(),this.showHideSpinner(!0);var dropPincodeEl=document.getElementById("pincode-input"),dropPincode=dropPincodeEl.value,pincodeErrorBanner=document.getElementsByClassName("pincode-error-banner")[0];if(dropPincodeEl&&setTimeout(()=>{dropPincodeEl.blur()},50),dropPincode.length===0){this.showErrorMessage(this.errorMessages.emptyPincode),this.showHideSpinner(!1);return}if(isValidPinCode(dropPincode)){this.hideErrorMessage();try{setLocalStorageItem(this.localStorageKeys.deliveryPincode,dropPincode),await this.showEstimateDeliveryDate(dropPincode,this.productTags),this.showHideSpinner(!1)}catch{setLocalStorageItem(this.localStorageKeys.deliveryPincode,dropPincode),this.showEstimateDeliveryDate(dropPincode,this.productTags),this.showHideSpinner(!1);return}}else this.showErrorMessage(this.errorMessages.invalidPincode),this.showHideSpinner(!1)};focusOutInput(){document.getElementById("pincode-input").style.border="1px solid #E5E5E5"}handlePincodeInput(e){var verifiedIcon=document.getElementsByClassName("verified-icon")[0],deliveryInfo=document.getElementsByClassName("delivery-info")[0],deliveryInfoContainer=document.getElementsByClassName("section-delivery-return-container")[0],deliveryInfoFbv=document.getElementsByClassName("delivery-info-fbv")[0];verifiedIcon.style.display="none",this.pageType==="product"&&(deliveryInfo.style.display="none",deliveryInfoContainer.style.display="none",deliveryInfoFbv.style.display="none"),this.hideErrorMessage(),this.isPincodeVerifiedMarkup(!1),this.inputValidation(e.target.value),e.target.value.length<=0&&(document.getElementById("pincode-input").style.fontWeight=400)}inputValidation(value){return value.length>=6?(document.getElementById("check-button").style.opacity="1",document.getElementById("check-button").style.pointerEvents="all"):(document.getElementById("check-button").style.opacity="0.25",document.getElementById("check-button").style.pointerEvents="none"),1}setDefaultDateInCollectionPage=async(defaultNumberOfDays,productId,productTags)=>{let deliveryTextElement=document.getElementById(`end_delivery_${productId}`),deliveryTextElementFBV=document.getElementById(`end_delivery_fbv_${productId}`);this.fbvTagExist(this.productTags)?(deliveryTextElementFBV.parentElement.style.display="flex",deliveryTextElementFBV.textContent="3 day Delivery"):deliveryTextElement&&(deliveryTextElement.parentElement.style.display="block",deliveryTextElement.textContent=this.calculateDeliveryDate(defaultNumberOfDays,0))};hideErrorMessage(){var pincodeErrorBanner=document.getElementsByClassName("pincode-error-banner")[0];pincodeErrorBanner.style.display="none"}getLocationPincode(){let self=this;if(self.showHideSpinner(!0),"geolocation"in navigator)try{navigator.geolocation.getCurrentPosition(function(position){var latitude=position.coords.latitude,longitude=position.coords.longitude,url=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}&zoom=18&addressdetails=1`;fetch(url).then(response=>response.json()).then(data=>{var pincode=data.address.postcode||null;pincode?(document.getElementById("pincode-input").value=pincode,self.handleCheckButton()):(document.getElementById("pincode-input").value="",self.showHideSpinner(!1),self.showErrorMessage())}).catch(error=>{console.error("Error:",error),self.showHideSpinner(!1),self.showErrorMessage()})},err=>{err.code===1&&self.showHideSpinner(!1)})}catch(err){console.log({err})}else self.showHideSpinner(!1)}}customElements.define("delivery-return",EstimateDelivery);class ChangePincodePopup extends HTMLElement{constructor(){super(),this.errorMessages={invalidPincode:"Delivery not available on pincode",emptyPincode:"Please enter PIN code to check delivery time",vendorNotFound:"Vendor Not Found"},this.localStorageKeys={deliveryPincode:"delivery-pincode",estimateDeliveryDays:"estimate-delivery-days"},this.apiUsername="vaaree",this.apiKey="666df8a8-f2e9-4fdf-a9cf-30350459b629",this.pincodeInput=this.querySelector("#pincode-input-plp"),this.storedPincode=getLocalStorageItem(this.localStorageKeys.deliveryPincode),this.pincodeErrorBanner=this.querySelector("#changePincodeContainer .pincode-error-banner"),this.verifiedIcon=this.querySelector(".verified-icon-plp"),this.eddPlpForm=this.querySelector("#edd-form-pincode"),this.showInputValue(),this.pincodeInput.addEventListener("input",this.handlePincodeInput.bind(this)),this.eddPlpForm.addEventListener("submit",async e=>{e.preventDefault(),this.handleCheckButtonClick()})}handlePincodeInput(e){this.hideErrorMessage(),this.isPincodeVerifiedMarkup(!1),this.inputValidation(e.target.value),e.target.value.length<=0&&(this.eddPlpForm.style.fontWeight=400)}getCityStateFromPincode=async pincode=>{try{var options={method:"GET",headers:{accept:"application/json"}},response=await fetch(`https://www.clickpost.in/api/v2/pincode_details/?pincode=${pincode}&key=${this.apiKey}`,options);if(!response.ok)throw new Error("Network response was not ok");var responseData=await response.json();if(responseData.meta.message==="Success")return responseData.result;throw new Error(responseData.Message)}catch(err){return console.log({err}),0}};isPincodeVerifiedMarkup(status){this.pincodeInput.style.border=status===!0?"1px solid #839A51":"1px solid #262727",this.pincodeInput.style.fontWeight=600,this.querySelector("#check-button-plp").textContent=status===!0?"Applied":"Apply",this.querySelector("#check-button-plp").style.opacity=status===!0?"0.25":"1",this.pincodeInput.style.color=status===!0?"#839A51":"#262727",this.querySelector(".check_tick_img-plp").style.display=status===!0?"block":"none",this.querySelector(".pincode-input-plp[type=tel]").style.paddingLeft=status===!0?"36px":"12px",this.querySelector("#check-button-plp").style.zIndex=status===!0?"0":"350"}hideErrorMessage(){let pincodeErrorBanner=this.querySelector(".pincode-error-banner-plp");pincodeErrorBanner.style.display="none"}handleCheckButtonClick=async()=>{let dropPincode=this.pincodeInput.value;if(isValidPinCode(dropPincode)){if(!await this.getCityStateFromPincode(dropPincode)){this.showErrorMessage(this.errorMessages.invalidPincode);return}this.isPincodeVerifiedMarkup(!0),setLocalStorageItem(this.localStorageKeys.deliveryPincode,dropPincode),window.location.reload()}};showInputValue(){this.storedPincode&&(this.pincodeInput.value=this.storedPincode,this.querySelector(".check_tick_img-plp").style.display="block")}inputValidation(value){return value.length>=6?(this.querySelector("#check-button-plp").style.opacity="1",this.querySelector("#check-button-plp").style.pointerEvents="all"):(this.querySelector("#check-button-plp").style.opacity="0.25",this.querySelector("#check-button-plp").style.pointerEvents="none"),1}showErrorMessage(text){this.pincodeInput.style.border="solid 1px #ed546f";let pincodeErrorBanner=this.querySelector(".pincode-error-banner-plp"),pincodeErrorMessage=this.querySelector(".error-message-plp");pincodeErrorBanner.style.display="flex",pincodeErrorMessage.textContent=text+` ${this.pincodeInput.value}`}}customElements.define("change-pincode-popup",ChangePincodePopup);function getLocalStorageItem(key){return localStorage.getItem(key)}function isValidPinCode(code){var regex=/^[1-9]{1}[0-9]{2}\s{0,1}[0-9]{3}$/;return regex.test(code)}function setLocalStorageItem(key,value){localStorage.setItem(key,value)}
//# sourceMappingURL=/cdn/shop/t/674/assets/edd.js.map?v=51063539464964687591715626307
